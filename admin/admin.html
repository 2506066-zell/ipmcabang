<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <title>Admin Kuis IPM</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="admin-future.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="page-admin">
    <div class="loading-overlay hidden" id="loading-overlay">
        <div class="loading-content">
            <div class="skeleton" style="width: 60px; height: 60px; border-radius: 50%;"></div>
            <p id="loading-text" style="margin-top:16px">Memuat...</p>
       </div>
    </div>

    <!-- MAIN CONTAINER -->
    <main class="admin-container">
        <!-- LOGIN SECTION -->
        <section class="card" id="login-card">
            <h1 class="card-title">Admin Kuis</h1>
            <p class="card-subtitle">
                Kelola data kuis dan hasil ujian.
            </p>

            <div class="field">
                <label for="admin-username">Username</label>
                <input id="admin-username" type="text" autocomplete="username" placeholder="Username admin">
            </div>
            <div class="field">
                <label for="admin-password">Password</label>
                <div style="position:relative">
                    <input id="admin-password" type="password" autocomplete="current-password" placeholder="Password admin">
                    <button type="button" id="toggle-admin-password" class="btn-ghost" style="position:absolute;right:0;top:0;height:100%;width:48px;" aria-label="Toggle password">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="field hidden">
                <label for="admin-token-input">Admin Token (Opsional)</label>
                <input id="admin-token-input" type="password" placeholder="Token khusus operasi database">
            </div>

            <div class="actions">
                <button class="btn btn-primary" id="admin-login-btn" type="button">
                    <i class="fas fa-right-to-bracket"></i> Masuk
                </button>
                <span class="status" id="status"></span>
            </div>
        </section>

        <!-- APP SECTION -->
        <section class="hidden" id="app-card">
            <!-- Header/Toolbar -->
            <div class="glass-card" style="position:sticky; top:0; z-index:100; border-radius: 0 0 16px 16px; margin: -16px -16px 0 -16px; padding:16px">
                <div class="toolbar-future">
                    <input id="search-input" class="neon-input" type="search" placeholder="Cari soal...">
                    <div class="mode-toggle" id="mode-toggle"></div>
                    <button class="cyber-button" id="logout-btn" title="Keluar"><i class="fas fa-right-from-bracket"></i></button>
                </div>
                <div style="display:flex; gap:8px; align-items:center; margin-top:10px; overflow-x:auto; padding-bottom:4px">
                    <select id="quiz-set-filter" class="neon-input" style="flex:0 0 160px">
                        <option value="all">Semua Kuis</option>
                        <option value="1">Kuis 1</option>
                        <option value="2">Kuis 2</option>
                        <option value="3">Kuis 3</option>
                    </select>
                    <select id="category-filter" class="neon-input" style="flex:0 0 200px">
                        <option value="all">Semua Kategori</option>
                    </select>
                    <button class="cyber-button" id="open-cmd"><i class="fas fa-terminal"></i> Ctrl+K</button>
                </div>
            </div>

            <div class="overview-grid">
                <div class="overview-tile"><div class="num" id="ov-total">0</div><div class="label">Total Soal</div></div>
                <div class="overview-tile"><div class="num" id="ov-active">0</div><div class="label">Soal Aktif</div></div>
                <div class="overview-tile"><div class="num" id="ov-results">0</div><div class="label">Hasil Terkumpul</div></div>
                <div class="overview-tile"><div class="num" id="ov-users">0</div><div class="label">Pengguna</div></div>
            </div>

            <!-- TABS CONTENT -->
            <div id="tab-questions">
                <div id="questions-list" class="list-container">
                    <!-- JS will populate cards here -->
                </div>
                <div id="q-sentinel" style="height:40px"></div>
                
                <div class="flex-center" style="margin-top:20px; gap:12px">
                    <button class="btn btn-secondary" id="q-prev">Prev</button>
                    <span id="q-page-info" class="small">Page 1</span>
                    <button class="btn btn-secondary" id="q-next">Next</button>
                </div>
            </div>

            <div id="tab-results" class="hidden">
                 <div class="toolbar-right" style="margin-bottom:16px">
                    <button class="btn btn-secondary" id="refresh-results-btn">
                        <i class="fas fa-rotate"></i> Refresh Data
                    </button>
                </div>
                <div id="results-list" class="list-container">
                    <!-- JS will populate results here -->
                </div>
                <div class="flex-center" style="margin-top:20px; gap:12px">
                    <button class="btn btn-secondary" id="r-prev">Prev</button>
                    <span id="r-page-info" class="small">Page 1</span>
                    <button class="btn btn-secondary" id="r-next">Next</button>
                </div>
            </div>
        </section>
    </main>

    <!-- FLOATING ACTION BUTTON -->
    <button class="fab hidden" id="fab-add-question" aria-label="Tambah Soal">
        <span class="fab-ring"></span>
        <i class="fas fa-plus"></i>
    </button>

    <div class="bulk-bar" id="bulk-bar">
        <span id="bulk-count">0 dipilih</span>
        <button class="cyber-button" id="bulk-delete"><i class="fas fa-trash"></i> Hapus</button>
        <button class="cyber-button" id="bulk-export"><i class="fas fa-file-export"></i> Export</button>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-nav hidden" id="bottom-nav">
        <button class="nav-item active" data-tab="questions">
            <i class="fas fa-list-ul"></i>
            <span>Soal</span>
        </button>
        <button class="nav-item" data-tab="results">
            <i class="fas fa-chart-bar"></i>
            <span>Hasil</span>
        </button>
        <button class="nav-item" id="nav-refresh">
            <i class="fas fa-rotate"></i>
            <span>Refresh</span>
        </button>
    </nav>

    <!-- MODAL (Overlay) -->
    <div class="modal" id="question-modal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Tambah Soal</h3>
                <button class="btn-ghost btn-icon" id="modal-close-btn" aria-label="Tutup">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Modal Tabs -->
            <div class="modal-tabs">
                <button type="button" class="modal-tab active" data-view="edit">Edit</button>
                <button type="button" class="modal-tab" data-view="preview">Preview</button>
            </div>
            
            <!-- Preview Panel -->
            <div id="preview-panel" class="hidden">
                <div class="preview-card">
                    <div class="preview-header">
                        <span class="preview-badge" id="prev-set">Kuis 1</span>
                        <span class="preview-badge" id="prev-cat">Sejarah</span>
                    </div>
                    <div class="preview-question" id="prev-question"></div>
                    <div class="preview-options" id="prev-options"></div>
                    <div class="preview-correct hidden">
                        <i class="fas fa-check-circle"></i> Kunci: <span id="prev-key">A</span>
                    </div>
                </div>
            </div>

            <form id="question-form">
                <input type="hidden" id="q-id">
                
                <div class="form-group">
                    <label>Set Kuis</label>
                    <div class="select-wrapper">
                        <select id="q-quizset" required>
                            <option value="1">Kuis 1 (Wawasan)</option>
                            <option value="2">Kuis 2 (IPM)</option>
                            <option value="3">Kuis 3 (Agama)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Tipe Soal</label>
                    <div class="select-wrapper">
                        <select id="q-type" required>
                            <option value="mcq">Pilihan Ganda</option>
                            <option value="tf">True / False</option>
                            <option value="essay">Essay</option>
                            <option value="matching">Matching</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Kategori</label>
                    <input type="text" id="q-category" placeholder="Contoh: Sejarah, Fiqih, Umum" list="category-list">
                    <datalist id="category-list">
                        <!-- Populated by JS -->
                    </datalist>
                </div>

                <div class="form-group">
                    <label>Pertanyaan</label>
                    <!-- Rich Text Toolbar -->
                    <div class="rich-text-toolbar">
                        <button type="button" class="btn-tool" data-tag="b" title="Bold"><i class="fas fa-bold"></i></button>
                        <button type="button" class="btn-tool" data-tag="i" title="Italic"><i class="fas fa-italic"></i></button>
                        <button type="button" class="btn-tool" data-tag="u" title="Underline"><i class="fas fa-underline"></i></button>
                        <button type="button" class="btn-tool" data-tag="code" title="Code"><i class="fas fa-code"></i></button>
                        <button type="button" class="btn-tool" data-tag="br" title="Baris Baru"><i class="fas fa-level-down-alt"></i></button>
                        <button type="button" class="btn-tool" data-tag="ol" title="List Angka"><i class="fas fa-list-ol"></i></button>
                        <button type="button" class="btn-tool" data-tag="ul" title="List Bullet"><i class="fas fa-list-ul"></i></button>
                        <button type="button" class="btn-tool" data-tag="link" title="Link"><i class="fas fa-link"></i></button>
                        <button type="button" class="btn-tool" data-tag="img" title="Gambar"><i class="fas fa-image"></i></button>
                    </div>
                    <textarea id="q-question" class="input-expandable" required placeholder="Tulis soal di sini..."></textarea>
                </div>

                <div class="form-group">
                    <label>Pilihan Jawaban</label>
                    <div class="option-grid">
                        <div class="input-group">
                            <span class="input-prefix">A</span>
                            <textarea id="q-a" class="input-expandable" required placeholder="Opsi A"></textarea>
                        </div>
                        <div class="input-group">
                            <span class="input-prefix">B</span>
                            <textarea id="q-b" class="input-expandable" required placeholder="Opsi B"></textarea>
                        </div>
                        <div class="input-group">
                            <span class="input-prefix">C</span>
                            <textarea id="q-c" class="input-expandable" required placeholder="Opsi C"></textarea>
                        </div>
                        <div class="input-group">
                            <span class="input-prefix">D</span>
                            <textarea id="q-d" class="input-expandable" required placeholder="Opsi D"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex:1">
                        <label>Kunci Jawaban</label>
                        <div class="select-wrapper">
                            <select id="q-correct" required>
                                <option value="a">A</option>
                                <option value="b">B</option>
                                <option value="c">C</option>
                                <option value="d">D</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="flex:1">
                        <label>Status</label>
                        <div class="select-wrapper">
                            <select id="q-active">
                                <option value="true">Aktif</option>
                                <option value="false">Nonaktif</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary" id="save-btn">Simpan</button>
                    <button type="button" class="btn btn-secondary" id="save-add-btn">Simpan & Tambah</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.error('SW Error:', err));
            });
        }
    </script>
    <div class="cmd-overlay" id="command-palette">
        <div class="cmd-box">
            <input id="cmd-input" class="cmd-input" placeholder="Cari perintah...">
            <div class="cmd-list" id="cmd-list"></div>
        </div>
    </div>
    <script src="admin.js?v=3"></script>
</body>
</html>
