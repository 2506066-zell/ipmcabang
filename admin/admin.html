<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <title>Admin Kuis IPM</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="page-admin">
    <div class="loading-overlay hidden" id="loading-overlay">
        <div class="loading-content">
            <div class="skeleton" style="width: 60px; height: 60px; border-radius: 50%;"></div>
            <p id="loading-text" style="margin-top:16px">Memuat...</p>
       </div>
    </div>

    <!-- MAIN CONTAINER -->
    <main class="admin-container">
        <!-- LOGIN SECTION -->
        <section class="card" id="login-card">
            <h1 class="card-title">Admin Kuis</h1>
            <p class="card-subtitle">
                Kelola data kuis dan hasil ujian.
            </p>

            <div class="field">
                <label for="admin-username">Username</label>
                <input id="admin-username" type="text" autocomplete="username" placeholder="Username admin">
            </div>
            <div class="field">
                <label for="admin-password">Password</label>
                <div style="position:relative">
                    <input id="admin-password" type="password" autocomplete="current-password" placeholder="Password admin">
                    <button type="button" id="toggle-admin-password" class="btn-ghost" style="position:absolute;right:0;top:0;height:100%;width:48px;" aria-label="Toggle password">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="field hidden">
                <label for="admin-token-input">Admin Token (Opsional)</label>
                <input id="admin-token-input" type="password" placeholder="Token khusus operasi database">
            </div>

            <div class="actions">
                <button class="btn btn-primary" id="admin-login-btn" type="button">
                    <i class="fas fa-right-to-bracket"></i> Masuk
                </button>
                <span class="status" id="status"></span>
            </div>
        </section>

        <!-- APP SECTION -->
        <section class="hidden" id="app-card">
            <!-- Header/Toolbar -->
            <div class="card" style="position:sticky; top:0; z-index:100; border-radius: 0 0 16px 16px; margin: -16px -16px 20px -16px;">
                <div style="display:flex; gap:12px; align-items:center; margin-bottom:12px">
                    <input id="search-input" type="search" placeholder="Cari soal..." style="flex:1">
                    <button class="btn btn-ghost btn-icon" id="logout-btn" title="Keluar">
                        <i class="fas fa-right-from-bracket"></i>
                    </button>
                </div>
                <div class="flex-center" style="justify-content:space-between; overflow-x:auto; gap:8px; padding-bottom:4px">
                     <select id="quiz-set-filter" style="width:auto; min-width:100px; font-size:14px; padding:8px">
                        <option value="all">Semua Kuis</option>
                        <option value="1">Kuis 1</option>
                        <option value="2">Kuis 2</option>
                        <option value="3">Kuis 3</option>
                    </select>
                    <select id="category-filter" style="width:auto; min-width:120px; font-size:14px; padding:8px">
                        <option value="all">Semua Kategori</option>
                    </select>
                </div>
            </div>

            <!-- TABS CONTENT -->
            <div id="tab-questions">
                <div id="questions-list" class="list-container">
                    <!-- JS will populate cards here -->
                </div>
                
                <div class="flex-center" style="margin-top:20px; gap:12px">
                    <button class="btn btn-secondary" id="q-prev">Prev</button>
                    <span id="q-page-info" class="small">Page 1</span>
                    <button class="btn btn-secondary" id="q-next">Next</button>
                </div>
            </div>

            <div id="tab-results" class="hidden">
                 <div class="toolbar-right" style="margin-bottom:16px">
                    <button class="btn btn-secondary" id="refresh-results-btn">
                        <i class="fas fa-rotate"></i> Refresh Data
                    </button>
                </div>
                <div id="results-list" class="list-container">
                    <!-- JS will populate results here -->
                </div>
                <div class="flex-center" style="margin-top:20px; gap:12px">
                    <button class="btn btn-secondary" id="r-prev">Prev</button>
                    <span id="r-page-info" class="small">Page 1</span>
                    <button class="btn btn-secondary" id="r-next">Next</button>
                </div>
            </div>
        <div id="tab-users" class="hidden">
        <div class="toolbar-right" style="margin-bottom:16px; display:flex; gap:8px; justify-content:space-between; align-items:center; flex-wrap:wrap;">
            <div style="display:flex; gap:8px; flex:1;">
                <input type="text" id="user-search-input" placeholder="Cari nama..." style="padding:8px; border-radius:8px; border:1px solid #ddd; flex:1; max-width:300px;">
                <select id="user-sort-select" style="padding:8px; border-radius:8px; border:1px solid #ddd;">
                    <option value="newest">Terbaru</option>
                    <option value="score_desc">Skor Tertinggi</option>
                    <option value="score_asc">Skor Terendah</option>
                    <option value="quiz_desc">Kuis Terbanyak</option>
                </select>
            </div>
           <button class="btn btn-secondary" id="refresh-users-btn">
               <i class="fas fa-rotate"></i> Refresh Data
           </button>
       </div>
       <div id="users-list" class="list-container">
           <!-- JS will populate users here -->
       </div>
   </div>

   <div id="tab-logs" class="hidden">
        <div class="toolbar-right" style="margin-bottom:16px">
           <button class="btn btn-secondary" id="refresh-logs-btn">
               <i class="fas fa-rotate"></i> Refresh Log
           </button>
       </div>
       <div id="logs-list" class="list-container">
           <!-- JS will populate logs here -->
       </div>
   </div>

   <div id="tab-schedules" class="hidden">
        <div class="card" style="margin-bottom:16px">
            <h3 style="margin-bottom:12px">Atur Jadwal Kuis</h3>
            <div id="schedules-list"></div>
            <button class="btn btn-secondary" id="add-schedule-btn" style="margin-top:12px; width:100%">
                <i class="fas fa-plus"></i> Tambah Jadwal Baru
            </button>
        </div>
        <div class="card">
            <h3 style="margin-bottom:12px">Manajemen Kuis</h3>
            <div class="form-group">
                <label>Reset Total Set Kuis (Hapus semua data user untuk set ini)</label>
                <div style="display:flex; gap:8px;">
                    <select id="reset-set-select" style="flex:1; padding:8px;">
                        <option value="1">Kuis 1</option>
                        <option value="2">Kuis 2</option>
                        <option value="3">Kuis 3</option>
                    </select>
                    <button class="btn btn-secondary" style="color:var(--accent-danger); border-color:var(--accent-danger);" id="global-reset-btn">
                        Reset Set
                    </button>
                </div>
            </div>
        </div>
   </div>
</section>
</main>

<!-- FLOATING ACTION BUTTON -->
<button class="fab hidden" id="fab-add-question" aria-label="Tambah Soal">
<i class="fas fa-plus"></i>
</button>

<!-- BOTTOM NAVIGATION -->
<nav class="bottom-nav hidden" id="bottom-nav">
<button class="nav-item active" data-tab="questions">
   <i class="fas fa-list-ul"></i>
   <span>Soal</span>
</button>
<button class="nav-item" data-tab="results">
   <i class="fas fa-chart-bar"></i>
   <span>Hasil</span>
</button>
<button class="nav-item" data-tab="users">
    <i class="fas fa-users"></i>
    <span>User</span>
 </button>
<button class="nav-item" data-tab="logs">
   <i class="fas fa-history"></i>
   <span>Logs</span>
</button>
<button class="nav-item" data-tab="schedules">
   <i class="fas fa-calendar-alt"></i>
   <span>Setting</span>
</button>
<button class="nav-item" id="nav-refresh">
   <i class="fas fa-rotate"></i>
   <span>Refresh</span>
</button>
</nav>

    <!-- MODAL (Overlay) -->
    <div class="modal" id="question-modal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Tambah Soal</h3>
                <button class="btn-ghost btn-icon" id="modal-close-btn" aria-label="Tutup">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Modal Tabs -->
            <div class="modal-tabs">
                <button type="button" class="modal-tab active" data-view="edit">Edit</button>
                <button type="button" class="modal-tab" data-view="preview">Preview</button>
            </div>
            
            <!-- Preview Panel -->
            <div id="preview-panel" class="hidden">
                <div class="preview-card">
                    <div class="preview-header">
                        <span class="preview-badge" id="prev-set">Kuis 1</span>
                        <span class="preview-badge" id="prev-cat">Sejarah</span>
                    </div>
                    <div class="preview-question" id="prev-question"></div>
                    <div class="preview-options" id="prev-options"></div>
                    <div class="preview-correct hidden">
                        <i class="fas fa-check-circle"></i> Kunci: <span id="prev-key">A</span>
                    </div>
                </div>
            </div>

            <!-- Schedule Modal -->
            <div id="schedule-modal-panel" class="hidden">
                 <form id="schedule-form">
                    <input type="hidden" id="sch-id">
                    <div class="form-group">
                        <label>Judul Event</label>
                        <input type="text" id="sch-title" required placeholder="Contoh: Kuis Ramadhan">
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex:1">
                            <label>Waktu Mulai</label>
                            <input type="datetime-local" id="sch-start">
                        </div>
                        <div class="form-group" style="flex:1">
                            <label>Waktu Selesai</label>
                            <input type="datetime-local" id="sch-end">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Simpan Jadwal</button>
                        <button type="button" class="btn btn-secondary" onclick="closeScheduleModal()">Batal</button>
                    </div>
                </form>
            </div>

            <form id="question-form">
                <input type="hidden" id="q-id">
                
                <div class="form-group">
                    <label>Set Kuis</label>
                    <div class="select-wrapper">
                        <select id="q-quizset" required>
                            <option value="1">Kuis 1 (UMUM)</option>
                            <option value="2">Kuis 2 (AGAMA)</option>
                            <option value="3">Kuis 3 (BIDANG)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Kategori</label>
                    <input type="text" id="q-category" placeholder="Contoh: Sejarah, Fiqih, Umum" list="category-list">
                    <datalist id="category-list">
                        <!-- Populated by JS -->
                    </datalist>
                </div>

                <div class="form-group">
                    <label>Pertanyaan</label>
                    <!-- Rich Text Toolbar -->
                    <div class="rich-text-toolbar">
                        <button type="button" class="btn-tool" data-tag="b" title="Bold"><i class="fas fa-bold"></i></button>
                        <button type="button" class="btn-tool" data-tag="i" title="Italic"><i class="fas fa-italic"></i></button>
                        <button type="button" class="btn-tool" data-tag="u" title="Underline"><i class="fas fa-underline"></i></button>
                        <button type="button" class="btn-tool" data-tag="code" title="Code"><i class="fas fa-code"></i></button>
                        <button type="button" class="btn-tool" data-tag="br" title="Baris Baru"><i class="fas fa-level-down-alt"></i></button>
                    </div>
                    <textarea id="q-question" class="input-expandable" required placeholder="Tulis soal di sini..."></textarea>
                </div>

                <div class="form-group">
                    <label>Pilihan Jawaban</label>
                    <div class="option-grid">
                        <div class="input-group">
                            <span class="input-prefix">A</span>
                            <textarea id="q-a" class="input-expandable" required placeholder="Opsi A"></textarea>
                        </div>
                        <div class="input-group">
                            <span class="input-prefix">B</span>
                            <textarea id="q-b" class="input-expandable" required placeholder="Opsi B"></textarea>
                        </div>
                        <div class="input-group">
                            <span class="input-prefix">C</span>
                            <textarea id="q-c" class="input-expandable" required placeholder="Opsi C"></textarea>
                        </div>
                        <div class="input-group">
                            <span class="input-prefix">D</span>
                            <textarea id="q-d" class="input-expandable" required placeholder="Opsi D"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex:1">
                        <label>Kunci Jawaban</label>
                        <div class="select-wrapper">
                            <select id="q-correct" required>
                                <option value="a">A</option>
                                <option value="b">B</option>
                                <option value="c">C</option>
                                <option value="d">D</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="flex:1">
                        <label>Status</label>
                        <div class="select-wrapper">
                            <select id="q-active">
                                <option value="true">Aktif</option>
                                <option value="false">Nonaktif</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary" id="save-btn">Simpan</button>
                    <button type="button" class="btn btn-secondary" id="save-add-btn">Simpan & Tambah</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.error('SW Error:', err));
            });
        }
    </script>
    <script src="admin.js?v=2"></script>
</body>
</html>
